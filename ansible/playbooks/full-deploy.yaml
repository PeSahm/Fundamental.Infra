---
# Full Stack Deployment Playbook
# ==============================
# Complete deployment of Fundamental platform from scratch
#
# This playbook runs all setup steps in the correct order:
# 1. VPS Setup (Docker, MicroK8s, UFW)
# 2. Registry Proxy Setup
# 3. Cert-Manager Setup (ClusterIssuers)
# 4. Kubernetes Secrets
# 5. ArgoCD Installation
# 6. Kubernetes Dashboard
# 7. Sentry Deployment
# 8. Application Deployment (Backend, Frontend, Migrations via ArgoCD)
#
# Note: GitHub Actions Runner requires manual token, run separately:
#   ansible-playbook -i inventory/hosts.ini playbooks/setup-github-runner.yaml \
#     -e "github_runner_token=YOUR_TOKEN"
#
# Usage:
#   ansible-playbook -i inventory/hosts.ini playbooks/full-deploy.yaml
#
# Or run individual playbooks:
#   ansible-playbook -i inventory/hosts.ini playbooks/setup-vps.yaml
#   ansible-playbook -i inventory/hosts.ini playbooks/setup-registry-proxy.yaml
#   ansible-playbook -i inventory/hosts.ini playbooks/setup-cert-manager.yaml
#   ansible-playbook -i inventory/hosts.ini playbooks/setup-kubernetes-secrets.yaml
#   ansible-playbook -i inventory/hosts.ini playbooks/setup-argocd.yaml
#   ansible-playbook -i inventory/hosts.ini playbooks/setup-kubernetes-dashboard.yaml
#   ansible-playbook -i inventory/hosts.ini playbooks/deploy-sentry.yaml
#   ansible-playbook -i inventory/hosts.ini playbooks/deploy-applications.yaml

- name: "Step 1: Setup VPS Infrastructure"
  ansible.builtin.import_playbook: setup-vps.yaml

- name: "Step 2: Setup Registry Proxy"
  ansible.builtin.import_playbook: setup-registry-proxy.yaml

- name: "Step 3: Setup Cert-Manager ClusterIssuers"
  ansible.builtin.import_playbook: setup-cert-manager.yaml

- name: "Step 4: Setup Kubernetes Secrets"
  ansible.builtin.import_playbook: setup-kubernetes-secrets.yaml

- name: "Step 5: Setup ArgoCD"
  ansible.builtin.import_playbook: setup-argocd.yaml

- name: "Step 6: Setup Kubernetes Dashboard"
  ansible.builtin.import_playbook: setup-kubernetes-dashboard.yaml

- name: "Step 7: Deploy Sentry"
  ansible.builtin.import_playbook: deploy-sentry.yaml

- name: "Step 8: Deploy Applications"
  ansible.builtin.import_playbook: deploy-applications.yaml

# Final summary is displayed by deploy-applications.yaml

